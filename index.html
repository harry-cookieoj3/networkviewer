<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Viewer - Visible Mode</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        /* 画面いっぱいに表示し、余計な余白（スクロールバー）を消す */
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; }
        #cy { width: 100vw; height: 100vh; background-color: #ebebeb; } /* 背景を少し暗いグレーに */
        #debug { position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px; font-size: 10px; z-index: 100; pointer-events: none; }
        #loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10; font-weight: bold; }
    </style>
</head>
<body>

    <div id="loading">読み込み中...</div>
    <div id="debug"></div>
    <div id="cy"></div>

    <script>
        const FILE_ID = '1Be7JMrTnqoarJ9R1Bdv3cZttJ0WPa73cisuYTERuYNY';
        const CSV_URL = `https://docs.google.com/spreadsheets/d/${FILE_ID}/export?format=csv`;

        async function init() {
            const debug = document.getElementById('debug');
            try {
                const response = await fetch(CSV_URL + '&t=' + new Date().getTime());
                const csvText = await response.text();
                const results = Papa.parse(csvText, { header: true, skipEmptyLines: true });
                const data = results.data;

                debug.innerText = `データ件数: ${data.length} 件`;

                const elements = [];
                data.forEach(row => {
                    const id = row.Id || row.id || row.ID;
                    const label = row.Label || row.label || row.name || id;
                    
                    if (id) {
                        elements.push({
                            data: { 
                                id: String(id), 
                                label: String(label),
                                // 白いノードを見えやすくするため、色は強制的に青、縁を黒にする
                                color: '#1a73e8' 
                            }
                        });
                    }
                });

                document.getElementById('loading').style.display = 'none';

                const cy = cytoscape({
                    container: document.getElementById('cy'),
                    elements: elements,
                    style: [
                        {
                            selector: 'node',
                            style: {
                                'label': 'data(label)',
                                'background-color': 'data(color)',
                                'width': 40,  // ノードを大きく
                                'height': 40,
                                'font-size': '14px',
                                'color': '#000',
                                'text-valign': 'bottom',
                                'text-margin-y': 8,
                                'border-width': 2,
                                'border-color': '#000' // 黒い縁取り
                            }
                        }
                    ],
                    layout: { 
                        name: 'cose', // 自動配置
                        padding: 100
                    }
                });

                // 画面に収まるように自動調整
                cy.fit();

            } catch (e) {
                document.getElementById('loading').innerText = "エラー: " + e.message;
            }
        }

        init();
    </script>
</body>
</html>
