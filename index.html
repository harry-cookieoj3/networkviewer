<script>
    const FILE_ID = '1Be7JMrTnqoarJ9R1Bdv3cZttJ0WPa73cisuYTERuYNY';
    const CSV_URL = `https://docs.google.com/spreadsheets/d/${FILE_ID}/export?format=csv`;

    async function init() {
        try {
            const response = await fetch(CSV_URL + '&t=' + new Date().getTime());
            const csvText = await response.text();
            const results = Papa.parse(csvText, { header: true, skipEmptyLines: true });
            const data = results.data;

            const elements = [];
            data.forEach(row => {
                const id = row.Id || row.id || row.ID;
                const label = row.Label || row.label || row.name || id;
                if (id) {
                    elements.push({
                        data: { 
                            id: String(id), 
                            label: String(label),
                            // 色が白っぽい場合に備えて、デフォルトをグレーにする
                            color: (row.Color && row.Color !== '#ffffff') ? row.Color : '#444'
                        }
                    });
                }
            });

            document.getElementById('loading').style.display = 'none';

            const cy = cytoscape({
                container: document.getElementById('cy'),
                elements: elements,
                style: [
                    {
                        selector: 'node',
                        style: {
                            'label': 'data(label)',
                            'background-color': 'data(color)',
                            'width': 30,  // サイズを大きく
                            'height': 30, // サイズを大きく
                            'font-size': '12px',
                            'text-valign': 'bottom',
                            'text-margin-y': 5,
                            'color': '#000', // 文字を黒に
                            'border-width': 1,
                            'border-color': '#000'
                        }
                    }
                ],
                layout: { 
                    // 一旦座標(x,y)を無視して、自動で綺麗に並べる設定にします
                    name: 'cose', 
                    animate: false,
                    padding: 50
                }
            });

        } catch (e) {
            document.getElementById('loading').innerText = "エラー: " + e.message;
        }
    }
    init();
</script>
